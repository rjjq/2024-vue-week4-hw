import{s as z,r as m,u as A,o as b,b as g,c as f,d as k,e as t,g as a,h as c,w as V,v as D,f as O,n as E,i as d,t as I,j as K}from"./index-BgZp6ebe.js";import{a as l,S as u}from"./sweetalert2-D8OhiPZJ.js";import{u as M}from"./loginStore-ZTVYyOv_.js";const P={id:"todoListPage",class:"bg-half"},R={class:"todo_sm"},U={class:"conatiner todoListPage vhContainer"},j={class:"todoList_Content"},q={class:"inputBox"},F={key:0,class:"alert alert-secondary text-center",role:"alert"},G={key:1,class:"todoList_list"},H={class:"todoList_tab"},J={class:"todoList_items"},Q={class:"todoList_item"},i="https://todolist-api.hexschool.io",oo={__name:"TodoView",setup(W){const x=M(),{nickname:w}=z(x),e=m(""),p=m(""),h=A(),T=async()=>{try{await l.post(`${i}/users/sign_out`,null,{headers:{Authorization:e.value}}),document.cookie="todoToken=; max-age=0; path=/;",e.value="",document.cookie="todoNickName=; max-age=0; path=/;",p.value="",u.fire({icon:"success",title:"登出成功",text:"即將跳轉到todo頁面...",showConfirmButton:!1,timer:1e3}).then(()=>{h.push("/login")})}catch(o){u.fire({icon:"error",title:"登出失敗",text:`錯誤 : ${o.response.data.message}`,showConfirmButton:!1,timer:3e3}),console.log(o)}h.push("/login")},$=async()=>{try{e.value||(await l.get(`${i}/users/checkout`,{headers:{Authorization:e.value}})).data.status||(document.cookie="todoToken=; max-age=0; path=/;",u.fire({icon:"error",title:"驗證失敗",text:"請重新登入...",showConfirmButton:!1,timer:1e3}).then(()=>{h.push("/login")}))}catch(o){document.cookie="todoToken=; max-age=0; path=/;",u.fire({icon:"error",title:"驗證失敗",text:`${o.response.data.message}`,showConfirmButton:!1,timer:1e3}).then(()=>{h.push("/login")}),console.log(o)}};b(()=>{e.value=document.cookie.replace(/(?:(?:^|.*;\s*)todoToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),p.value=document.cookie.replace(/(?:(?:^|.*;\s*)todoNickName\s*=\s*([^;]*).*$)|^.*$/,"$1"),w.value=p.value||"",$(),_()});const s=m(""),y=async()=>{if(console.log("newTodo:",s.value.trim),s.value.trim()===""){u.fire("待辦事項不得為空，請重新輸入..."),s.value="";return}try{(await l.post(`${i}/todos/`,{content:s.value},{headers:{Authorization:e.value}})).status==201&&(s.value=""),_()}catch(o){console.log(o)}},v=m([]),_=async()=>{try{const o=await l.get(`${i}/todos/`,{headers:{Authorization:e.value}});o.status==200&&(v.value=o.data.data)}catch(o){console.log(o)}},L=async o=>{try{await l.patch(`${i}/todos/${o}/toggle`,null,{headers:{Authorization:e.value}}),_()}catch(n){console.log(n)}},C=async o=>{try{await l.delete(`${i}/todos/${o}`,{headers:{Authorization:e.value}}),_()}catch(n){console.log(n)}};return(o,n)=>{const r=g("router-link"),N=g("font-awesome-icon"),B=g("router-view");return f(),k("div",P,[t("nav",null,[t("h1",null,[a(r,{to:"/todo/all"},{default:c(()=>[d("ONLINE TODO LIST")]),_:1})]),t("ul",null,[t("li",R,[a(r,{to:"/todo/all"},{default:c(()=>[d(I(K(w))+"的代辦",1)]),_:1})]),t("li",null,[t("a",{onClick:T},"登出")])])]),t("div",U,[t("div",j,[t("div",q,[V(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":n[0]||(n[0]=S=>s.value=S),onKeyup:O(y,["enter"])},null,544),[[D,s.value]]),t("a",{class:E(["button",{disabled:!s.value}]),onClick:y},[a(N,{icon:["fas","plus"]})],2)]),v.value.length==0?(f(),k("div",F," 目前尚無待辦事項 ")):(f(),k("div",G,[t("ul",H,[t("li",null,[a(r,{to:"/todo/all"},{default:c(()=>[d("全部")]),_:1})]),t("li",null,[a(r,{to:"/todo/pending"},{default:c(()=>[d("待完成")]),_:1})]),t("li",null,[a(r,{to:"/todo/completed"},{default:c(()=>[d("已完成")]),_:1})])]),t("div",J,[t("ul",Q,[a(B,{todoList:v.value,onDelTodo:C,onToggleStatus:L},null,8,["todoList"])])])]))])])])}}};export{oo as default};
