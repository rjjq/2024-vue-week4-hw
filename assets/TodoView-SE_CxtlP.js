import{s as b,r as _,u as V,o as D,a as O,k as R,b as f,c as g,d as k,e as t,h as n,i as u,w as E,v as I,g as K,n as M,j as d,t as P,l as U}from"./index-BbjktQmv.js";import{a as l,S as h}from"./sweetalert2-D8OhiPZJ.js";import{u as j}from"./loginStore-BVI4D_X-.js";const q={id:"todoListPage",class:"bg-half"},F={class:"todo_sm"},G={class:"conatiner todoListPage vhContainer"},H={class:"todoList_Content"},J={class:"inputBox"},Q={key:0,class:"alert alert-secondary text-center",role:"alert"},W={key:1,class:"todoList_list"},X={class:"todoList_tab"},Y={class:"todoList_items"},Z={class:"todoList_item"},i="https://todolist-api.hexschool.io",ao={__name:"TodoView",setup(oo){const T=j(),{nickname:w}=b(T),s=_(""),v=_(""),m=V(),x=async()=>{try{await l.post(`${i}/users/sign_out`,null,{headers:{Authorization:s.value}}),document.cookie="todoToken=; max-age=0; path=/;",s.value="",document.cookie="todoNickName=; max-age=0; path=/;",v.value="",h.fire({icon:"success",title:"登出成功",text:"即將跳轉到todo頁面...",showConfirmButton:!1,timer:1e3}).then(()=>{m.push("/login")})}catch(o){h.fire({icon:"error",title:"登出失敗",text:`錯誤 : ${o.response.data.message}`,showConfirmButton:!1,timer:3e3}),console.log(o)}m.push("/login")},$=async()=>{try{s.value||(await l.get(`${i}/users/checkout`,{headers:{Authorization:s.value}})).data.status||(document.cookie="todoToken=; max-age=0; path=/;",h.fire({icon:"error",title:"驗證失敗",text:"請重新登入...",showConfirmButton:!1,timer:1e3}).then(()=>{m.push("/login")}))}catch(o){document.cookie="todoToken=; max-age=0; path=/;",h.fire({icon:"error",title:"驗證失敗",text:`${o.response.data.message}`,showConfirmButton:!1,timer:1e3}).then(()=>{m.push("/login")}),console.log(o)}};D(()=>{s.value=document.cookie.replace(/(?:(?:^|.*;\s*)todoToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),v.value=document.cookie.replace(/(?:(?:^|.*;\s*)todoNickName\s*=\s*([^;]*).*$)|^.*$/,"$1"),w.value=v.value||"",$(),p()});const a=_(""),y=async()=>{if(console.log("newTodo:",a.value.trim),a.value.trim()===""){h.fire("待辦事項不得為空，請重新輸入..."),a.value="";return}try{(await l.post(`${i}/todos/`,{content:a.value},{headers:{Authorization:s.value}})).status==201&&(a.value=""),p()}catch(o){console.log(o)}},r=_([]),p=async()=>{try{const o=await l.get(`${i}/todos/`,{headers:{Authorization:s.value}});o.status==200&&(r.value=o.data.data)}catch(o){console.log(o)}},L=async o=>{try{await l.patch(`${i}/todos/${o}/toggle`,null,{headers:{Authorization:s.value}}),p()}catch(e){console.log(e)}},N=async o=>{try{await l.delete(`${i}/todos/${o}`,{headers:{Authorization:s.value}}),p()}catch(e){console.log(e)}},C=O(),B=R(()=>{const o=C.name;return o==="all"?r.value:o==="completed"?r.value.filter(e=>e.status):o==="pending"?r.value.filter(e=>!e.status):[]});return(o,e)=>{const c=f("router-link"),S=f("font-awesome-icon"),z=f("router-view");return g(),k("div",q,[t("nav",null,[t("h1",null,[n(c,{to:"/todo/all"},{default:u(()=>[d("ONLINE TODO LIST")]),_:1})]),t("ul",null,[t("li",F,[n(c,{to:"/todo/all"},{default:u(()=>[d(P(U(w))+"的代辦",1)]),_:1})]),t("li",null,[t("a",{onClick:x},"登出")])])]),t("div",G,[t("div",H,[t("div",J,[E(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":e[0]||(e[0]=A=>a.value=A),onKeyup:K(y,["enter"])},null,544),[[I,a.value]]),t("a",{class:M(["button",{disabled:!a.value}]),onClick:y},[n(S,{icon:["fas","plus"]})],2)]),r.value.length==0?(g(),k("div",Q," 目前尚無待辦事項 ")):(g(),k("div",W,[t("ul",X,[t("li",null,[n(c,{to:"/todo/all"},{default:u(()=>[d("全部")]),_:1})]),t("li",null,[n(c,{to:"/todo/pending"},{default:u(()=>[d("待完成")]),_:1})]),t("li",null,[n(c,{to:"/todo/completed"},{default:u(()=>[d("已完成")]),_:1})])]),t("div",Y,[t("ul",Z,[n(z,{todoList:B.value,onDelTodo:N,onToggleStatus:L},null,8,["todoList"])])])]))])])])}}};export{ao as default};
